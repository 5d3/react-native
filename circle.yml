general:
  branches:
    ignore:
      - gh-pages # list of branches to ignore
machine:
  node:
    version: 6.2.0
  environment:
    PATH: "~/$CIRCLE_PROJECT_REPONAME/gradle-2.9/bin:/home/ubuntu/buck/bin:$PATH"
    TERM: "dumb"
    ADB_INSTALL_TIMEOUT: 10
    GRADLE_OPTS: '-Dorg.gradle.jvmargs="-Xmx512m -XX:+HeapDumpOnOutOfMemoryError"'
  java:
    version: 'oraclejdk8'

dependencies:
  override:
    - cd website && npm install
  cache_directories:
    - "website/node_modules"

test:
  override:
    # testing docs generation
    - cd website && npm test
    - cd website && node ./server/generate.js

deployment:
  stable:
    branch: [/.*-stable/, /master/]
    commands:
      # generate docs website
      - git config --global user.email "reactjs-bot@users.noreply.github.com"
      - git config --global user.name "Website Deployment Script"
      - echo "machine github.com login reactjs-bot password $GITHUB_TOKEN" > ~/.netrc
      - cd website && GIT_USER=reactjs-bot npm run gh-pages
      - node ./scripts/publish-npm.js

experimental:
  notify:
    branches:
      only:
        - master
        - /.*-stable/
